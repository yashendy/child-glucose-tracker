<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·ÙÙ„ â€” Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
<style>
:root{
  --brand:#0ea5e9; --brand2:#6ee7b7; --ink:#0f172a; --muted:#6b7280;
  --bg:#f6fbff; --card:#fff; --line:#e5e7eb;
  --tile1:#dbeafe; --tile2:#dcfce7; --tile3:#ffe4e6; --tile4:#fef9c3; --tile5:#ede9fe; --tile6:#e0f2fe;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.6 system-ui,"Tajawal","Noto Sans Arabic",sans-serif}
a{text-decoration:none;color:inherit}

.topbar{
  position:sticky;top:0;z-index:10;
  background:linear-gradient(90deg,var(--brand),var(--brand2));
  color:#fff;padding:12px 14px;display:flex;align-items:center;justify-content:space-between;gap:8px
}
.btn{border:none;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn.ghost{background:#ffffff22;border:1px solid #ffffff66;color:#fff}
.container{max-width:1100px;margin:auto;padding:14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.05)}
.row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.note{color:var(--muted);font-size:13px}

.header{
  display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap;margin-bottom:12px
}
.kid{display:flex;align-items:center;gap:12px}
.avatar{width:72px;height:72px;border-radius:50%;object-fit:cover;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.12)}
.kmeta{color:#334155;font-size:13px}
.badge{display:inline-block;background:#eef6ff;color:#0369a1;border-radius:999px;padding:6px 10px;font-weight:800}

.grid{
  display:grid;gap:14px;
  grid-template-columns:repeat(3,minmax(0,1fr));
}
@media(max-width:960px){.grid{grid-template-columns:1fr 1fr}}
@media(max-width:640px){.grid{grid-template-columns:1fr}}

.tile{
  background:var(--tile1);
  border:1px solid var(--line);
  border-radius:16px; padding:16px; min-height:112px;
  display:flex; flex-direction:column; justify-content:space-between;
  transition:.2s transform, .2s box-shadow;
}
.tile:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.06)}
.tile h3{margin:0 0 4px;font-size:18px}
.tile p{margin:0;color:#374151;font-size:13px}
.tile .go{align-self:flex-start;margin-top:10px}
.tile .go .btn{background:#0ea5e9;color:#fff}

.tile.t2{background:var(--tile2)}
.tile.t3{background:var(--tile3)}
.tile.t4{background:var(--tile4)}
.tile.t5{background:var(--tile5)}
.tile.t6{background:var(--tile6)}

.footer{
  margin-top:14px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap
}
.kpis{display:flex;gap:8px;flex-wrap:wrap}
.kpi{background:#ecfeff;border:1px solid #bae6fd;color:#075985;padding:6px 10px;border-radius:999px;font-weight:800;font-size:12px}

.toast{position:fixed;bottom:16px;left:16px;background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transform:translateY(8px);transition:.3s;z-index:9999}
.toast.show{opacity:1;transform:none}
</style>
</head>
<body>

<header class="topbar">
  <div class="row">
    <a class="btn ghost" href="dashboard.html">Ù„ÙˆØ­Ø© ÙˆÙ„ÙŠÙ‘ Ø§Ù„Ø£Ù…Ø±</a>
  </div>
  <div id="hello" class="row">Ù…Ø±Ø­Ø¨Ù‹Ø§â€¦</div>
  <button id="btnLogout" class="btn ghost">Ø®Ø±ÙˆØ¬</button>
</header>

<main class="container">
  <section class="card">
    <div class="header">
      <div class="kid">
        <img id="kidAvatar" class="avatar" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„">
        <div>
          <div id="kidName" style="font-weight:800;font-size:18px">â€”</div>
          <div id="kidMeta" class="kmeta">â€”</div>
        </div>
      </div>
      <span id="unitBadge" class="badge">Ø§Ù„ÙˆØ­Ø¯Ø©: mmol/L</span>
    </div>

    <div class="grid">
      <div class="tile t1">
        <div>
          <h3>ğŸ§’ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</h3>
          <p>Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù†ÙˆØ¹ØŒ Ø§Ù„Ø·ÙˆÙ„/Ø§Ù„ÙˆØ²Ù†ØŒ Ø§Ù„Ø­Ø¯ÙˆØ¯ØŒ ICRâ€¦</p>
        </div>
        <div class="go"><a id="linkProfile" class="btn">ÙØªØ­</a></div>
      </div>

      <div class="tile t2">
        <div>
          <h3>ğŸ§ª Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø³ÙƒØ±</h3>
          <p>ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙŠÙˆÙ… ÙˆÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª.</p>
        </div>
        <div class="go"><a id="linkMeasures" class="btn">ÙØªØ­</a></div>
      </div>

      <div class="tile t3">
        <div>
          <h3>ğŸ½ï¸ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</h3>
          <p>Ø§Ø®ØªÙŠØ§Ø± Ø£ØµÙ†Ø§ÙØŒ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙƒØ§Ø±Ø¨ØŒ Ø¬Ø±Ø¹Ø© Ù…Ù‚ØªØ±Ø­Ø©.</p>
        </div>
        <div class="go"><a id="linkMeals" class="btn">ÙØªØ­</a></div>
      </div>

      <div class="tile t4">
        <div>
          <h3>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
          <p>Ø£Ø³Ø¨ÙˆØ¹/Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†/Ø´Ù‡Ø± â€” PDF Ø¬Ø§Ù‡Ø² Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.</p>
        </div>
        <div class="go"><a id="linkReports" class="btn">ÙØªØ­</a></div>
      </div>

      <div class="tile t5">
        <div>
          <h3>ğŸ§‘â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨</h3>
          <p>Ù…Ù„Ø®ØµØ§ØªØŒ Ù…Ø®Ø·Ø·Ø§ØªØŒ Ù†Ø³Ø¨ Ø¯Ø§Ø®Ù„/Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚.</p>
        </div>
        <div class="go"><a id="linkDoctor" class="btn">ÙØªØ­</a></div>
      </div>

      <div class="tile t6">
        <div>
          <h3>ğŸ“… Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h3>
          <p>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©ØŒ Ø§Ù„Ù…Ø±ÙÙ‚Ø§ØªØŒ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ø®Øµ.</p>
        </div>
        <div class="go"><a id="linkVisits" class="btn">ÙØªØ­</a></div>
      </div>
    </div>

    <div class="footer">
      <div class="kpis" id="kpis">
        <span class="kpi" id="kpiICR">ICR: â€”</span>
        <span class="kpi" id="kpiBounds">Ø§Ù„Ø­Ø¯ÙˆØ¯: â€”</span>
      </div>
      <div class="note">ØªÙ„Ù…ÙŠØ­: Ø§Ø­ÙØ¸ÙŠ ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„ Ù…Ù† â€œØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„â€ Ù„ØªØ¸Ù‡Ø± Ù‡Ù†Ø§.</div>
    </div>
  </section>
</main>

<div id="toast" class="toast"></div>

<script type="module">
/* ===== Firebase init (Ø§Ø¹ØªÙ…Ø¯ÙŠ Ø¹Ù„Ù‰ Ù…Ù„ÙÙƒ firebase-init.js) ===== */
import { app, db, auth } from './firebase-init.js';
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const $ = s => document.querySelector(s);
const params = new URLSearchParams(location.search);
const childId = params.get('child');

const FALLBACK_SVG = 'data:image/svg+xml;utf8,' + encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96">
  <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#0ea5e9"/><stop offset="1" stop-color="#6ee7b7"/></linearGradient></defs>
  <rect width="100%" height="100%" rx="48" fill="url(#g)"/>
  <circle cx="48" cy="38" r="16" fill="#fff"/>
  <path d="M16 82a32 24 0 0 1 64 0" fill="#fff"/>
</svg>`);

function toast(msg, ms=2200){
  const t = $('#toast'); t.textContent = msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), ms);
}

let uid=null, child=null;

onAuthStateChanged(auth, async (user)=>{
  if(!user){ location.href='index.html'; return; }
  uid = user.uid;
  $('#hello').textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ â€” UID: ${uid.slice(0,6)}â€¦`;
  if(!childId){ toast('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·ÙÙ„'); return; }
  await loadChild();
  wireLinks();
});

async function loadChild(){
  try{
    const snap = await getDoc(doc(db,'users',uid,'children',childId));
    if(!snap.exists()){ toast('âš ï¸ Ø§Ù„Ø·ÙÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'); return; }
    child = snap.data() || {};
    $('#kidName').textContent = child.name || 'â€”';
    $('#kidMeta').textContent = `${child.gender||'â€”'} â€¢ ${child.weight??'â€”'} ÙƒØ¬Ù… â€¢ ${child.height??'â€”'} Ø³Ù…`;
    $('#unitBadge').textContent = `Ø§Ù„ÙˆØ­Ø¯Ø©: ${(child.unit||'mmol/L')}`;
    $('#kpiICR').textContent = `ICR: ${child.icr!=null ? child.icr : 'â€”'}`;
    $('#kpiBounds').textContent = `Ø§Ù„Ø­Ø¯ÙˆØ¯: ${child.lowThreshold??'â€”'} â€“ ${child.highThreshold??'â€”'}`;

    const img = $('#kidAvatar');
    img.src = child.photoURL || FALLBACK_SVG;
    img.onerror = ()=>{ img.src = FALLBACK_SVG; };
  }catch(e){
    console.error(e);
    toast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„');
  }
}

function linkWithId(base){ return `${base}?child=${encodeURIComponent(childId)}`; }
function wireLinks(){
  $('#linkProfile').href  = linkWithId('child-profile.html');
  $('#linkMeasures').href = linkWithId('child-measures.html');
  $('#linkMeals').href    = linkWithId('child-meals.html');
  $('#linkReports').href  = linkWithId('child-reports.html');
  $('#linkDoctor').href   = linkWithId('child-doctor.html');
  $('#linkVisits').href   = linkWithId('child-visits.html');
}

$('#btnLogout').addEventListener('click', ()=> signOut(auth).then(()=>location.href='index.html'));
</script>
</body>
</html>

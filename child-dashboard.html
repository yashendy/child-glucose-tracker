<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·ÙÙ„ â€” Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙƒØ± Ø§Ù„Ø£Ø·ÙØ§Ù„</title>
  <style>
    /*  ===== Ø£Ù†Ù…Ø§Ø· Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙƒØ§Ù…Ù„Ø© ===== */
    :root{--brand:#0ea5e9;--brand2:#6ee7b7;--line:#e5e7eb;--ink:#0f172a;--muted:#6b7280;
      --bg:#f6fbff;--card:#fff;--ok:#10b981;--warn:#f59e0b;--bad:#ef4444;
      --chip:#eef6ff;--hi:#f97316;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.6 "Tajawal",system-ui,sans-serif;
      display:flex;min-height:100vh}
    .sidebar{width:260px;flex:0 0 260px;background:linear-gradient(180deg,var(--brand),var(--brand2));
      color:#fff;padding:16px;position:sticky;top:0;height:100vh;overflow:auto}
    .sb-title{font-weight:800;font-size:18px;margin-bottom:12px}
    .sb-btn{display:block;width:100%;text-align:right;background:transparent;border:none;color:#fff;
      padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700;margin:4px 0}
    .sb-btn:hover,.sb-btn.active{background:rgba(255,255,255,.18)}
    .spacer{height:6px}
    .main{flex:1;min-width:0}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--brand),var(--brand2));
      color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
    .head-left{display:flex;align-items:center;gap:12px}
    .kid-photo{width:56px;height:56px;border-radius:16px;overflow:hidden;
      border:2px solid rgba(255,255,255,.75);background:#fff;display:grid;place-items:center}
    .kid-photo img{width:100%;height:100%;object-fit:cover;display:block}
    .avatar-fallback{width:100%;height:100%;display:none;place-items:center;background:#e0f7fa;
      color:#0f172a;font-weight:800;font-size:18px}
    .title-wrap{display:flex;flex-direction:column}
    .hello{font-size:14px;opacity:.9}
    .kid-name{font-size:18px;font-weight:800}
    .head-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:none;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
    .btn.gray{background:#eef2f7}
    .btn.dark{background:#0f172a;color:#fff}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.orange{background:var(--hi);color:#fff}
    main{max-width:1200px;margin:auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;
      padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:14px}
    .note{color:var(--muted);font-size:14px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--chip);
      color:#0f172a;font-size:12px;margin-inline-start:6px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .grid{display:grid;gap:12px}
    .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media(max-width:900px){.g3{grid-template-columns:1fr 1fr}}
    @media(max-width:680px){.g2,.g3{grid-template-columns:1fr}}
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);
      border-radius:10px;background:#fff}
    textarea{min-height:90px;resize:vertical}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid var(--line);padding:8px;text-align:center}
    th{background:#f0f9ff}
    .status{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px}
    .ok{background:#ecfdf5;color:var(--ok)}
    .high{background:#fee2e2;color:#ef4444}
    .low{background:#fff7ed;color:#b45309}
    .meals-layout{display:grid;grid-template-columns:220px 1fr;gap:12px}
    .cats{display:flex;flex-direction:column;gap:8px}
    .cat-btn{border:1px solid var(--line);background:#fff;color:var(--ink);
      border-radius:10px;padding:8px 10px;cursor:pointer;text-align:right;font-weight:700}
    .cat-btn.active,.cat-btn:hover{background:#e6f7ff;border-color:#cfefff}
    .foods-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
    .food-card{border:1px solid var(--line);background:#fff;border-radius:14px;padding:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.04)}
    .food-card img{width:80px;height:80px;object-fit:contain;display:block;margin:0 auto 6px}
    .food-name{font-weight:800;text-align:center}
    .food-sub{font-size:12px;color:var(--muted);text-align:center;margin-bottom:8px}
    .toggle{display:flex;gap:6px;justify-content:center;margin:6px 0}
    .toggle button{flex:1;border:1px solid var(--line);background:#fff;padding:6px 8px;
      border-radius:8px;cursor:pointer;font-weight:700}
    .toggle button.active{background:#eef6ff;border-color:#cfefff}
    .food-actions{display:flex;gap:6px;align-items:center;justify-content:center}
    .small{font-size:12px;color:var(--muted)}
    .basket{border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .basket th{background:#fff}
    .basket tfoot td{font-weight:800}
    .pill{display:inline-block;background:#f1f5f9;border-radius:999px;padding:3px 8px;font-size:12px}
    .toast{position:fixed;bottom:16px;left:16px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transform:translateY(6px);transition:.25s}
    .toast.show{opacity:1;transform:none}
    .section{display:none}
    .section.active{display:block}

    /*  ===== Ø£Ù†Ù…Ø§Ø· ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ===== */
    .controls-rep {
      background: var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin-bottom:14px;
    }
    .controls-rep .grid {
      display:grid;gap:10px;grid-template-columns:repeat(4,minmax(0,1fr));
    }
    @media(max-width:900px){.controls-rep .grid{grid-template-columns:1fr 1fr}}
    .table-rep {width:100%;border-collapse:separate;border-spacing:0}
    .table-rep th, .table-rep td {border:1px solid var(--line);padding:8px;vertical-align:top;text-align:right}
    .table-rep thead th {background:#f8fafc;font-weight:800;text-align:right}
    .table-rep td.date {background:#fbfdff;white-space:nowrap;font-weight:800}
    .cell {display:flex;flex-direction:column;gap:3px}
    .line {font-size:12px}
    .state {padding:2px 8px;border-radius:999px;width:max-content;margin:0}
    .state.ok {color:var(--ok);background:var(--card)}
    .state.low {color:var(--warn);background:#fff7ed}
    .state.high {color:var(--bad);background:#fee2e2}
    @media print {
      @page {size:A4 landscape;margin:8mm}
      body {font-size:11px;background:#fff}
      header, .controls-rep {display:none!important}
      .card, .section {border:0;box-shadow:none;padding:0;margin:0}
      .table-rep th, .table-rep td {padding:4px}
      .line {font-size:10px}
    }
  </style>
</head>
<body>

<aside class="sidebar">
  <div class="sb-title">ğŸ‘§ Ù„ÙˆØ­Ø© Ø§Ù„Ø·ÙÙ„</div>
  <button class="sb-btn active" data-target="sec-home">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <div class="spacer"></div>
  <button class="sb-btn" data-target="sec-info">âš™ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</button>
  <button class="sb-btn" data-target="sec-measure">ğŸ“ Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø³ÙƒØ±</button>
  <button class="sb-btn" data-target="sec-meals">ğŸ½ï¸ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</button>
  <button class="sb-btn" data-target="sec-reports">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  <button class="sb-btn" data-target="sec-doctor">ğŸ§‘â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨</button>
  <button class="sb-btn" data-target="sec-visits">ğŸ“… Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</button>
</aside>

<div class="main">
  <header>
    <div class="head-left">
      <div class="kid-photo">
        <img id="childPhoto" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„">
        <div id="avatarFallback" class="avatar-fallback">ğŸ‘§</div>
      </div>
      <div class="title-wrap">
        <div class="hello">Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹</div>
        <div id="kidName" class="kid-name">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…...</div>
      </div>
    </div>
    <div class="head-actions">
      <a class="btn gray" href="dashboard.html">Ù„ÙˆØ­Ø© ÙˆÙ„ÙŠÙ‘ Ø§Ù„Ø£Ù…Ø±</a>
      <button id="btnLogout" class="btn dark">Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <main>
    <!-- 1: Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <section id="sec-home" class="section active">
      <div class="card"><div class="note">Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.</div></div>
    </section>

  
   <!-- (2) Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„ + Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
      <section id="sec-info" class="section">
        <section class="card" id="childInfoSection">
          <h3 class="section-title">âš™ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</h3>
          <div class="grid g3">
            <div><label>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</label><input id="childName" placeholder="Ù…Ø«Ø§Ù„: Ù„ÙŠÙ„Ù‰ Ø£Ø­Ù…Ø¯"></div>
            <div>
              <label>Ø§Ù„Ù†ÙˆØ¹</label>
              <div class="row" style="gap:14px">
                <label><input type="radio" name="gender" value="male"> Ø°ÙƒØ±</label>
                <label><input type="radio" name="gender" value="female"> Ø£Ù†Ø«Ù‰</label>
              </div>
            </div>
            <div><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ</label><input id="childCivilId" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"></div>
            <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input id="dob" type="date"></div>
            <div><label>Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label><input id="heightCm" type="number" step="0.1"></div>
            <div><label>Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label><input id="weightKg" type="number" step="0.1"></div>
            <div><label>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©</label>
              <select id="preferredUnit"><option value="mmol">mmol/L</option><option value="mgdl">mg/dL</option></select>
            </div>
            <div><label>Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
              <select id="defaultMeasurementType">
                <option value="fingerstick">ğŸ©¸ ÙØ­Øµ Ø¥ØµØ¨Ø¹</option>
                <option value="cgm">ğŸ“ˆ CGM</option>
                <option value="lab">ğŸ§ª Ù…Ø®ØªØ¨Ø±</option>
                <option value="other">âœ³ï¸ Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
            <div style="grid-column:1/-1"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><input id="notes" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"></div>
          </div>
          <div class="row" style="margin-top:8px">
            <button id="btnSaveInfo" class="btn primary">ğŸ’¾ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</button>
          </div>
        </section>

        <section class="card" id="glucoseDosingSection">
          <h3 class="section-title">ğŸ§ª Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ Ùˆ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª
            <span id="unitBadge" class="badge">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: mmol/L</span>
          </h3>
          <div class="grid g3">
            <div><label>Ø§Ù„Ù‡Ø¯Ù</label><input id="target" type="number" step="0.1"></div>
            <div><label>Ø­Ø¯ Ø§Ù„Ù‡Ø¨ÙˆØ·</label><input id="low" type="number" step="0.1"></div>
            <div><label>Ø­Ø¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label><input id="high" type="number" step="0.1"></div>
            <div><label>ØªØ±Ø³ÙŠØ¨Ø§ (U/Day)</label><input id="tresiba" type="number" step="0.5"></div>
            <div><label>TDI (U)</label><input id="tdi" type="number" step="0.5"></div>
            <div><label>ISF <span id="isfUnitLabel" class="badge">mmol/L Ù„ÙƒÙ„ 1U</span></label><input id="isf" type="number" step="0.1"></div>
            <div><label>ICR (Ø¬Ø±Ø§Ù…/ÙˆØ­Ø¯Ø©)</label><input id="icr" type="number" step="0.1"></div>
          </div>
          <div class="row" style="margin-top:8px">
            <button id="btnSuggest" class="btn gray">ğŸ’¡ Ø§Ø­Ø³Ø¨ Ù…Ù† TDI</button>
            <button id="btnSaveGlucose" class="btn primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          </div>
          <div class="note" style="margin-top:8px">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª: ISFâ‰ˆ100/TDI (mmol/L/U) â€” ICRâ‰ˆ500/TDI (g/U).</div>
        </section>
      </section>


    <!-- 3: Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø³ÙƒØ± -->
   <section id="sec-measure" class="section">
        <section class="card">
          <h3 class="section-title">ğŸ“ Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø³ÙƒØ± <span id="mUnitBadge" class="badge">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: mmol/L</span></h3>
          <div class="grid g3">
            <div><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" id="dateSel" /></div>
            <div><label>ÙˆÙ‚Øª Ø§Ù„Ù‚ÙŠØ§Ø³</label>
              <select id="slotSel">
                <option value="">â€” Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„ÙˆÙ‚Øª â€”</option>
                <option value="preBreakfast">Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø±</option>
                <option value="postBreakfast">Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±</option>
                <option value="preLunch">Ù‚Ø¨Ù„ Ø§Ù„ØºØ¯Ø§Ø¡</option>
                <option value="postLunch">Ø¨Ø¹Ø¯ Ø§Ù„ØºØ¯Ø§Ø¡</option>
                <option value="preDinner">Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø´Ø§Ø¡</option>
                <option value="postDinner">Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡</option>
                <option value="bedtime">Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…</option>
                <option value="exercise">Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</option>
                <option value="other">Ø£Ø®Ø±Ù‰...</option>
              </select>
            </div>
            <div><label>Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ§Ø³</label>
              <select id="mType">
                <option value="fingerstick">ğŸ©¸ ÙØ­Øµ Ø¥ØµØ¨Ø¹</option>
                <option value="cgm">ğŸ“ˆ CGM</option>
                <option value="lab">ğŸ§ª Ù…Ø®ØªØ¨Ø±</option>
                <option value="other">âœ³ï¸ Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
          </div>
        </section>

        <section class="card">
          <h3 class="section-title">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚ÙŠØ§Ø³ ÙˆØ§Ù„ÙˆØ¬Ø¨Ø©</h3>
          <div class="grid g3">
            <div><label>Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</label><input type="number" id="reading" step="0.1" min="0"/><div id="statusBadge" class="status ok" style="display:none;"></div></div>
            <div><label>ÙƒØ§Ø±Ø¨ (Ø¬Ù…)</label><input type="number" id="carbs" step="0.1" min="0"/></div>
            <div><label>Ø¬Ø±Ø¹Ø© Ù…Ù‚ØªØ±Ø­Ø© (ICR)</label><input type="number" id="suggestedDose" readonly/></div>
            <div><label>Ø¬Ø±Ø¹Ø© ÙØ¹Ù„ÙŠØ©</label><input type="number" id="mealDose" step="0.1"/></div>
            <div id="correctionSection" style="display:none;"><label>Ø¬Ø±Ø¹Ø© ØªØµØ­ÙŠØ­ÙŠØ©</label><input type="number" id="correction" step="0.1"/></div>
            <div id="raiseSection" style="display:none;"><label>Ø±ÙØ¹ Ø§Ù„Ø³ÙƒØ±</label><input type="text" id="raise"/></div>
            <div style="grid-column:1/-1"><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><textarea id="note" rows="2"></textarea></div>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠØ§Ø³</button>
            <button class="btn gray" id="reloadDay">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</button>
          </div>
        </section>

        <section class="card">
          <h3 class="section-title">Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
          <table>
            <thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¬Ø±Ø¹Ø© Ø§Ù„ÙˆØ¬Ø¨Ø©</th><th>Ø§Ù„ØªØµØ­ÙŠØ­/Ø§Ù„Ø±ÙØ¹</th><th>Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ§Ø³</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr></thead>
            <tbody id="rows"><tr><td colspan="7" class="note">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø¡Ø§Øª Ù„Ù„ÙŠÙˆÙ….</td></tr></tbody>
          </table>
        </section>
      </section>

      <!-- (3) Ø§Ù„ÙˆØ¬Ø¨Ø§Øª â€” Ø¬Ø¯ÙŠØ¯ -->
      <section id="sec-meals" class="section">
        <section class="card">
          <div class="row" style="justify-content:space-between; align-items:center">
            <h3 class="section-title">ğŸ½ï¸ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</h3>
            <div class="row">
              <a href="foods-admin.html" class="btn orange">ğŸ—‚ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</a>
            </div>
          </div>

          <!-- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø© -->
          <div class="grid g3" style="margin-bottom:10px">
            <div><label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ø¨Ø©</label>
              <select id="mealType">
                <option value="breakfast">ÙØ·ÙˆØ±</option>
                <option value="lunch">ØºØ¯Ø§Ø¡</option>
                <option value="dinner">Ø¹Ø´Ø§Ø¡</option>
                <option value="snack">Ø³Ù†Ø§Ùƒ</option>
                <option value="other">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
            <div><label>ÙˆÙ‚Øª Ø§Ù„Ø£ÙƒÙ„</label><input id="mealTime" type="datetime-local"></div>
            <div><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><input id="mealNotes" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ"></div>
          </div>

          <div class="meals-layout">
            <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
            <div>
              <div class="row" style="margin-bottom:8px">
                <input id="foodSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." style="width:100%">
              </div>
              <div id="catList" class="cats"></div>
            </div>

            <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø£ØµÙ†Ø§Ù -->
            <div>
              <div id="foodsGrid" class="foods-grid"><div class="note">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>

              <!-- Ø§Ù„Ø³Ù„Ø© -->
              <div class="card" style="margin-top:12px">
                <div class="row" style="justify-content:space-between">
                  <h4 style="margin:0">ğŸ§º Ø³Ù„Ø© Ø§Ù„ÙˆØ¬Ø¨Ø©</h4>
                  <div class="small">ICR Ø§Ù„Ø­Ø§Ù„ÙŠ: <b id="icrNow">â€”</b> g/U</div>
                </div>
                <div class="basket" style="margin-top:8px; overflow:auto">
                  <table>
                    <thead><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„ÙƒØ§Ø±Ø¨ (Ø¬Ù…)</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="basketBody"><tr><td colspan="4" class="note">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.</td></tr></tbody>
                    <tfoot>
                      <tr><td><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</b></td><td></td><td id="totalCarbsCell">0.0</td><td></td></tr>
                    </tfoot>
                  </table>
                </div>

                <div class="grid g3" style="margin-top:10px">
                  <div><label>Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</label><input id="doseSuggestedMeal" readonly></div>
                  <div><label>Ø¬Ø±Ø¹Ø© ÙØ¹Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="doseGivenMeal" type="number" step="0.1"></div>
                  <div class="row" style="align-items:flex-end; justify-content:flex-end">
                    <button id="saveMealBtn" class="btn primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø©</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="note" style="margin-top:8px">Ø§Ù„Ø­Ø³Ø§Ø¨: (Ø§Ù„Ø¬Ø±Ø§Ù…Ø§Øª Ã— ÙƒØ§Ø±Ø¨/100) Ã· 100 â€¢ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© = Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ§Ø±Ø¨ Ã· ICR (ØªÙ‚Ø±ÙŠØ¨ 0.1U).</div>
        </section>
      </section>

    </section>

    <!-- 4: Ø§Ù„ÙˆØ¬Ø¨Ø§Øª -->
    <section id="sec-meals" class="section">
      ... <!-- Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ù‡Ù†Ø§ -->
    </section>

    <!-- 5: Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
    <section id="sec-reports" class="section">
      <section class="controls-rep card">
        <div class="grid">
          <div><label>Ø§Ù„Ø·ÙÙ„</label><select id="childSelRep"><option value="">â€” Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø·ÙÙ„ â€”</option></select></div>
          <div><label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label><input type="date" id="fromRep"></div>
          <div><label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label><input type="date" id="toRep"></div>
          <div style="display:flex;align-items:end">
            <button id="runRep" class="btn primary">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
          </div>
        </div>
        <div id="childMetaRep" class="note" style="margin-top:10px;"></div>
        <div id="blankHeaderRep" class="blank-header" style="display:none;margin-top:10px;"></div>
      </section>
      <section id="reportBoxRep" class="card" style="display:none;">
        <button id="btnBlankRep" class="btn gray" style="margin-bottom:10px;">Ø·Ø¨Ø§Ø¹Ø© ÙˆØ±Ù‚Ø© ÙØ§Ø±ØºØ©</button>
        <button id="btnPrintRep" class="btn primary" style="margin-bottom:10px;">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <table id="repTable" class="table-rep"></table>
      </section>
    </section>

    <!-- 6: Ø§Ù„Ø·Ø¨ÙŠØ¨ -->
    <section id="sec-doctor" class="section">
      <div class="card"><div class="note">ğŸ§‘â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨ â€” Ù‚Ø±ÙŠØ¨Ù‹Ø§.</div></div>
    </section>

    <!-- 7: Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© -->
    <section id="sec-visits" class="section">
      <div class="card"><div class="note">ğŸ“… Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© â€” Ù‚Ø±ÙŠØ¨Ù‹Ø§.</div></div>
    </section>
  </main>
</div>

<div id="toast" class="toast"></div>

<script type="module">
  import { db, auth } from './firebase-init.js';
  import {
    onAuthStateChanged, signOut
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import {
    doc, getDoc, setDoc,
    collection, getDocs, addDoc, query, orderBy, limit, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const $ = s => document.querySelector(s);
  const $$ = s => [...document.querySelectorAll(s)];
  const toastEl = $('#toast');
  const showToast = (m) => {
    toastEl.textContent = m;
    toastEl.classList.add('show');
    setTimeout(() => toastEl.classList.remove('show'), 2200);
  };
  const escapeHtml = s => (s || '').replace(/[&<>"']/g, m =>
    ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }[m]));

  /** Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø§Ù„ØªÙ†Ù‚Ù„ */
  $$('.sb-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      $$('.sb-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      $$('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(btn.dataset.target).classList.add('active');
    });
  });

  /*** ØªÙ‚Ø§Ø±ÙŠØ± â€” Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ***/
  function enumerateDates(from, to) {
    const res = [], d = new Date(from), end = new Date(to);
    while (d <= end) {
      res.push(d.toISOString().slice(0, 10));
      d.setDate(d.getDate() + 1);
    }
    return res;
  }
  function stateLabel(s) {
    return s === 'low' ? 'â¬‡ï¸ Ù…Ù†Ø®ÙØ¶' :
           s === 'high' ? 'â¬†ï¸ Ù…Ø±ØªÙØ¹' :
           'âœ”ï¸ Ø·Ø¨ÙŠØ¹ÙŠ';
  }

  auth.onAuthStateChanged(async user => {
    if (!user) { location.href = 'index.html'; return; }

    // â€” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    $('#btnLogout').addEventListener('click', () => signOut(auth).then(() => location.href = 'index.html'));

    // â€” Ù„ ØªØ´ØºÙŠÙ„ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ§Ù„Ù‚ÙŠØ§Ø³ØŒ Ø¶Ø¹ÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ Ù‡Ù†Ø§Ùƒ.
    // â€” Ù‡Ù†Ø§ ÙÙ‚Ø· ØªÙƒÙ…ÙŠÙ„ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±:
    await loadChildrenRep(user.uid);
    setDefaultsRep();
    $('#runRep').addEventListener('click', () => buildReportRep(user.uid));
    $('#btnBlankRep').addEventListener('click', () => printBlankRep());
    $('#btnPrintRep').addEventListener('click', () => window.print());
  });

  async function loadChildrenRep(uid) {
    const sel = $('#childSelRep');
    sel.innerHTML = '<option>â€” ØªØ­Ù…ÙŠÙ„ â€”</option>';
    const snap = await getDocs(collection(db, 'users', uid, 'children'));
    sel.innerHTML = '<option value="">â€” Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø·ÙÙ„ â€”</option>';
    snap.forEach(s => {
      const o = document.createElement('option');
      o.value = s.id;
      o.textContent = s.data().name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
      sel.appendChild(o);
    });
  }

  function setDefaultsRep() {
    const iso = new Date().toISOString().slice(0, 10);
    $('#fromRep').value = iso;
    $('#toRep').value = iso;
  }

  async function buildReportRep(uid) {
    const childId = $('#childSelRep').value, from = $('#fromRep').value, to = $('#toRep').value;
    if (!childId || !from || !to) return alert('Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø·ÙÙ„ ÙˆØ­Ø¯Ø¯ÙŠ Ø§Ù„ÙØªØ±Ø©');
    $('#blankHeaderRep').style.display = 'none';
    const cSnap = await getDoc(doc(db, 'users', uid, 'children', childId));
    const c = cSnap.data() || {};
    $('#childMetaRep').innerHTML = `<b>Ø§Ù„Ø·ÙÙ„:</b> ${c.name || 'â€”'} â€¢ <b>Ø§Ù„ÙˆØ²Ù†:</b> ${c.weight || 'â€”'} ÙƒØ¬Ù… â€¢ <b>Ø§Ù„Ø·ÙˆÙ„:</b> ${c.height || 'â€”'} Ø³Ù…`;

    const dates = enumerateDates(from, to);
    const snaps = await Promise.all(dates.map(d =>
      getDoc(doc(db, 'users', uid, 'children', childId, 'measurements', d))
    ));
    const byDate = {};
    snaps.forEach((snap, i) => byDate[dates[i]] = snap.data() || { readings: {} });

    const tbl = $('#repTable');
    tbl.innerHTML = '';
    const thead = document.createElement('thead');
    const htr = document.createElement('tr');
    htr.innerHTML = `<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>${['Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø±','Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±','Ù‚Ø¨Ù„ Ø§Ù„ØºØ¯Ø§Ø¡','Ø¨Ø¹Ø¯ Ø§Ù„ØºØ¯Ø§Ø¡','Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø´Ø§Ø¡','Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡',
      'Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…','Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†ÙˆÙ…','Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸'].map(t => `<th>${t}</th>`).join('')}`;
    thead.appendChild(htr);
    tbl.appendChild(thead);

    const tbody = document.createElement('tbody');
    dates.forEach(d => {
      const readings = byDate[d].readings || {};
      const tr = document.createElement('tr');
      let rowHtml = `<td class="date">${d}</td>`;
      ['preBreakfast','postBreakfast','preLunch','postLunch',
       'preDinner','postDinner','beforeSleep','duringSleep','uponWake']
      .forEach(slot => {
        const r = readings[slot];
        if (!r || (r.valueMmol == null && r.value == null)) {
          rowHtml += '<td>â€”</td>';
        } else {
          const val = r.value ?? r.valueMmol;
          const st = r.status || 'ok';
          rowHtml += `<td><div class="cell">
                        <div class="line"><b>Ø§Ù„Ù‚ÙŠØ§Ø³:</b> ${val}</div>
                        ${r.mealDose != null ? `<div class="line">Ø¬Ø±Ø¹Ø©: ${r.mealDose}U</div>` : ''}
                        ${r.correction != null ? `<div class="line">ØªØµØ­ÙŠØ­ÙŠ: ${r.correction}U</div>` : ''}
                        ${r.note ? `<div class="line note">Ù…Ù„Ø§Ø­Ø¸Ø©: ${escapeHtml(r.note)}</div>` : ''}
                        <div class="line state ${st}">${stateLabel(st)}</div>
                      </div></td>`;
        }
      });
      tr.innerHTML = rowHtml;
      tbody.appendChild(tr);
    });
    tbl.appendChild(tbody);
    $('#reportBoxRep').style.display = 'block';
  }

  function printBlankRep() {
    const childId = $('#childSelRep').value;
    if (!childId) return alert('Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø·ÙÙ„ Ø£ÙˆÙ„Ø§Ù‹');

    $('#childMetaRep').innerHTML = '';
    $('#blankHeaderRep').style.display = 'flex';
    $('#blankHeaderRep').innerHTML = `
      <span class="bh-item">Ø§Ù„Ø§Ø³Ù…:<span class="line"></span></span>
      <span class="bh-item">Ø§Ù„ÙˆØ²Ù†:<span class="line"></span></span>
      <span class="bh-item">Ø§Ù„Ø·ÙˆÙ„:<span class="line"></span></span>`;

    const tbl = $('#repTable');
    tbl.innerHTML = '';
    const thead = document.createElement('thead');
    const htr = document.createElement('tr');
    htr.innerHTML = `<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>${['Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø±','Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±','Ù‚Ø¨Ù„ Ø§Ù„ØºØ¯Ø§Ø¡','Ø¨Ø¹Ø¯ Ø§Ù„ØºØ¯Ø§Ø¡',
      'Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø´Ø§Ø¡','Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡','Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…','Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†ÙˆÙ…','Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸']
      .map(t => `<th>${t}</th>`).join('')}`;
    thead.appendChild(htr);
    tbl.appendChild(thead);

    const tbody = document.createElement('tbody');
    for (let i = 0; i < 7; i++) {
      const tr = document.createElement('tr');
      let rowHtml = `<td class="date">&nbsp;</td>`;
      for (let j = 0; j < 9; j++) {
        rowHtml += `<td>
                      <div class="cell">
                        <div class="line">Ø§Ù„Ù‚ÙŠØ§Ø³: ________</div>
                        <div class="line">Ø¬Ø±Ø¹Ø©: ________</div>
                        <div class="line">Ù…Ù„Ø§Ø­Ø¸Ø©: _______________</div>
                        <div class="line">Ø§Ù„Ø­Ø§Ù„Ø©: ________</div>
                      </div>
                    </td>`;
      }
      tr.innerHTML = rowHtml;
      tbody.appendChild(tr);
    }
    tbl.appendChild(tbody);
    $('#reportBoxRep').style.display = 'block';
    setTimeout(() => window.print(), 50);
  }
</script>

</body>
</html>
